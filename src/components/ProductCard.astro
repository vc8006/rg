---
interface Props {
  slug: string; name: string; brand: string; category: string;
  price: number; originalPrice?: number; image: string; inStock: boolean; caliber: string;
}
const { slug, name, brand, category, price, originalPrice, image, inStock, caliber } = Astro.props;
const discount = originalPrice ? Math.round(((originalPrice - price) / originalPrice) * 100) : 0;
const fmt = (p: number) => new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(p);
---

<a href={`/product/${slug}`} class="product-card group block rounded-lg border border-border hover:border-border-hover hover:shadow-md bg-card transition-all duration-200">
  <div class="relative overflow-hidden bg-bg-alt rounded-t-lg aspect-[4/3] flex items-center justify-center p-5">
    <img src={image} alt={name} class="product-image max-h-full max-w-full object-contain transition-transform duration-300" loading="lazy" />
    {discount > 0 && <span class="absolute top-2 left-2 bg-brand text-white text-[10px] font-bold px-1.5 py-0.5 rounded">-{discount}%</span>}
    {!inStock && <div class="absolute inset-0 bg-bg/70 flex items-center justify-center"><span class="text-red text-xs font-semibold bg-red-bg px-3 py-1 rounded-full">Out of Stock</span></div>}
  </div>
  <div class="p-4">
    <div class="flex items-center gap-1.5 mb-1 text-[11px]">
      <span class="uppercase tracking-wider font-medium text-muted">{brand}</span>
      <span class="text-faint">Â·</span>
      <span class="text-brass font-medium">{category}</span>
    </div>
    <h3 class="text-heading text-[15px] font-semibold leading-snug mb-0.5 group-hover:text-brand transition-colors">{name}</h3>
    <p class="text-muted text-xs mb-3">{caliber}</p>
    <div class="flex items-baseline gap-2 pt-3 border-t border-border">
      <span class="text-heading font-bold">{fmt(price)}</span>
      {originalPrice && originalPrice > price && <span class="text-faint text-xs line-through">{fmt(originalPrice)}</span>}
    </div>
  </div>
</a>
