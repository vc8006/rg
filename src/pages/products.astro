---
import BaseLayout from '../layouts/BaseLayout.astro';
import ProductCard from '../components/ProductCard.astro';
import products from '../data/products.json';

const categories = ['All', ...new Set(products.map(p => p.category))];
---

<BaseLayout title="Products" description="Browse our complete range of airguns, pellets, and accessories.">

  <section class="bg-bg-alt border-b border-border">
    <div class="max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <p class="text-[11px] font-semibold uppercase tracking-[0.15em] text-brass mb-1">Shop</p>
      <h1 class="text-2xl font-bold text-heading tracking-tight mb-1">Our Products</h1>
      <p class="text-muted text-sm">Explore our complete range of airguns, pellets, and accessories. All 100% genuine with warranty.</p>
    </div>
  </section>

  <section>
    <div class="max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <div class="flex flex-wrap items-center gap-2 mb-6">
        {categories.map(cat => (
          <button data-category={cat} class:list={['filter-btn px-3 py-1.5 rounded-full text-[13px] font-medium border transition-all cursor-pointer', cat === 'All' ? 'bg-brand text-white border-brand' : 'text-muted border-border hover:border-border-hover hover:text-heading bg-card']}>
            {cat}
          </button>
        ))}
      </div>

      <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5">
        {products.map(p => (
          <div data-cat={p.category} class="product-item">
            <ProductCard slug={p.slug} name={p.name} brand={p.brand} category={p.category} price={p.price} originalPrice={p.originalPrice} image={p.images[0]} inStock={p.inStock} caliber={p.caliber} />
          </div>
        ))}
      </div>

      <p id="empty-msg" class="hidden text-center py-16 text-muted">No products found in this category.</p>
    </div>
  </section>

</BaseLayout>

<script>
  const btns = document.querySelectorAll('.filter-btn');
  const items = document.querySelectorAll<HTMLElement>('.product-item');
  const empty = document.getElementById('empty-msg');

  btns.forEach(b => b.addEventListener('click', () => {
    const cat = b.getAttribute('data-category');
    btns.forEach(x => { x.classList.remove('bg-brand', 'text-white', 'border-brand'); x.classList.add('text-muted', 'border-border', 'bg-card'); });
    b.classList.remove('text-muted', 'border-border', 'bg-card'); b.classList.add('bg-brand', 'text-white', 'border-brand');
    let visible = 0;
    items.forEach(el => { const match = cat === 'All' || el.dataset.cat === cat; el.style.display = match ? '' : 'none'; if (match) visible++; });
    if (empty) empty.classList.toggle('hidden', visible > 0);
  }));
</script>
